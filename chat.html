<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Only Docs bot</title>

  <!-- Material Symbols (arrow icon) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=arrow_forward_ios">

  <style>
    /*  ✅ YOUR SAME CSS — unchanged  */
    /*   --------------------------- */
    :root{
      --bg: #000;
      --blue: #00aaff;
      --yellow: #ffee00;
      --white: #ffffff;
      --gray-bubble: rgba(255,255,255,0.06);
      --maxWidth: 900px;
      --input-min-height: 44px;
      --input-max-height: 220px;
      --gutter: 22px;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      font-family: sans-serif;
      color:var(--white);
      overflow: hidden;
    }

    .brand {
      position: fixed;
      left: 18px;
      top: 12px;
      z-index: 40;
      display:flex;
      gap:8px;
      align-items:baseline;
      user-select: none;
      font-weight:700;
      font-size:18px;
    }
    .brand .only { color: var(--yellow); }
    .brand .docs { color: var(--blue); }
    .brand .bot  { color: var(--white); }

    .stage {
      max-width: var(--maxWidth);
      width: min(92%, var(--maxWidth));
      margin: 72px auto 0 auto;
      height: calc(100vh - 72px - var(--input-min-height) - 28px);
      display:flex;
      flex-direction:column;
    }

    .chat {
      flex: 1 1 auto;
      overflow-y: auto;
      padding: 28px var(--gutter);
      display:flex;
      flex-direction:column;
      gap:16px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.12) transparent;
    }
    .chat::-webkit-scrollbar { width:10px; }
    .chat::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.10);
      border-radius:8px;
    }

    .msg-row { display:flex; width:100%; }
    .msg-row.bot  { justify-content:flex-start; }
    .msg-row.user { justify-content:flex-end; }

    .bubble {
      max-width:76%;
      padding: 14px 18px;
      border-radius: 14px;
      background: var(--gray-bubble);
      font-size: 16px;
      line-height:1.45;
      white-space: pre-wrap;
      word-break: break-word;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      overflow-wrap: anywhere;
    }
    .bubble.bot  { color: var(--blue);  text-align:left;  }
    .bubble.user { color: var(--yellow); text-align:left; }

    .input-bar {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      width: min(92%, var(--maxWidth));
      z-index: 60;
      box-sizing: border-box;
      padding: 10px;
      border-radius: 14px;
      background: rgba(0,0,0,0.22);
      border: 2px solid rgba(255,255,255,0.08);
      display:flex;
      gap:12px;
      align-items:flex-end;
    }

    .input-left {
      flex:1;
      display:flex;
      align-items:flex-end;
      gap:12px;
    }

    textarea.input-field {
      width:100%;
      min-height: var(--input-min-height);
      max-height: var(--input-max-height);
      resize: none;
      overflow: auto;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      outline: none;
      background: rgba(255,255,255,0.03);
      color: #ddd;
      font-size: 15px;
      line-height: 1.4;
      font-family: sans-serif;
      box-sizing: border-box;
    }
    textarea.input-field::placeholder {
      color: rgba(255,255,255,0.30);
    }

    .send-btn {
      width: 56px;
      height: 44px;
      display:inline-grid;
      place-items:center;
      border:none;
      background:transparent;
      cursor:pointer;
      padding:4px;
    }
    .send-btn[disabled] { opacity: 0.45; cursor: not-allowed; }

    .material-symbols-outlined {
      font-size: 24px;
      color: var(--blue);
    }

  </style>
</head>

<body>

  <div class="brand">
    <div class="only">Only</div>
    <div class="docs">Docs</div>
    <div class="bot">bot</div>
  </div>

  <div class="stage">
    <div id="chat" class="chat"></div>
  </div>

  <div class="input-bar">
    <div class="input-left">
      <textarea id="msgInput" class="input-field" placeholder="Ask me..." spellcheck="false"></textarea>
    </div>

    <button id="sendBtn" class="send-btn">
      <span class="material-symbols-outlined">arrow_forward_ios</span>
    </button>
  </div>

<script>
/* ✅ ✅ ✅   Updated script with TYPEWRITER RESPONSE   ✅ ✅ ✅ */
(function(){
  const API_URL = "http://127.0.0.1:8000/ask";
  const chat = document.getElementById('chat');
  const textarea = document.getElementById('msgInput');
  const sendBtn = document.getElementById('sendBtn');

  function scrollToBottom(){
    chat.scrollTo({ top: chat.scrollHeight, behavior:"smooth" });
  }

  function el(cls, text) {
    const row = document.createElement('div');
    row.className = 'msg-row ' + cls;
    const bubble = document.createElement('div');
    bubble.className = 'bubble ' + cls;
    bubble.textContent = text;
    row.appendChild(bubble);
    return { row, bubble };
  }

  function addMessage(text, who){
    const { row, bubble } = el(who, text);
    chat.appendChild(row);
    scrollToBottom();
    return bubble;
  }

  /** ✅ TYPE LETTER BY LETTER **/
  async function typeWriter(text, bubble) {
    bubble.textContent = "";
    let i = 0;
    const speed = 18;      // lower = faster

    return new Promise((resolve)=>{
      const interval = setInterval(()=>{
        bubble.textContent += text[i];
        i++;
        scrollToBottom();
        if(i >= text.length){
          clearInterval(interval);
          resolve();
        }
      }, speed);
    });
  }

  async function sendMessage(){
    const raw = textarea.value.trim();
    if(!raw) return;

    addMessage(raw, "user");
    textarea.value = "";
    textarea.style.height = "auto";

    const loadingBubble = addMessage("typing...", "bot");

    let reply = "";
    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: raw })
      });
      const data = await res.json();
      reply = data.response || "No response";
    } catch {
      reply = "Error: could not reach the server";
    }

    loadingBubble.textContent = "";
    await typeWriter(reply, loadingBubble);
  }

  sendBtn.addEventListener("click", sendMessage);

  textarea.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      sendMessage();
    }
  });

  textarea.addEventListener("input", ()=>{
    textarea.style.height = "auto";
    textarea.style.height = textarea.scrollHeight + "px";
  });

  window.onload = ()=> textarea.focus();
})();
</script>

</body>
</html>
